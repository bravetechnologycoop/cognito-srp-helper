var re=Object.create;var T=Object.defineProperty;var ne=Object.getOwnPropertyDescriptor;var se=Object.getOwnPropertyNames;var oe=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var ie=(t,e)=>{for(var r in e)T(t,r,{get:e[r],enumerable:!0})},M=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of se(e))!ae.call(t,s)&&s!==r&&T(t,s,{get:()=>e[s],enumerable:!(n=ne(e,s))||n.enumerable});return t};var ce=(t,e,r)=>(r=t!=null?re(oe(t)):{},M(e||!t||!t.__esModule?T(r,"default",{value:t,enumerable:!0}):r,t)),ge=t=>M(T({},"__esModule",{value:!0}),t);var Se={};ie(Se,{AbortOnZeroASrpError:()=>P,AbortOnZeroBSrpError:()=>E,AbortOnZeroSrpError:()=>w,AbortOnZeroUSrpError:()=>H,MissingChallengeResponsesError:()=>B,MissingDeviceKeyError:()=>v,MissingLargeBError:()=>S,MissingSaltError:()=>A,MissingSecretError:()=>C,MissingUserIdForSrpBError:()=>I,SignSrpSessionError:()=>d,createDeviceVerifier:()=>he,createPasswordHash:()=>J,createSecretHash:()=>fe,createSrpSession:()=>pe,signSrpSession:()=>me,signSrpSessionWithDevice:()=>Be,wrapAuthChallenge:()=>Ce,wrapInitiateAuth:()=>Ae});module.exports=ge(Se);var a=require("buffer/"),g=ce(require("crypto-js"),1);var o=class t{value;static ZERO=new t("0");static ONE=new t("1");constructor(e,r=16){if(r!==16)throw new Error(`Unsupported radix: ${r}. Only radix 16 (hexadecimal) is supported.`);if(typeof e=="bigint")this.value=e;else{let n=e.startsWith("-"),s=n?e.slice(1):e;this.value=BigInt(`0x${s}`),n&&(this.value=-this.value)}}add(e){return new t(this.value+e.value)}subtract(e){return new t(this.value-e.value)}multiply(e){return new t(this.value*e.value)}divide(e){return new t(this.value/e.value)}mod(e){return new t(this.value%e.value)}modPow(e,r){if(r.value===0n)throw new Error("Modulus cannot be zero.");let n=this.value%r.value,s=e.value,i=1n;for(;s>0n;)s%2n===1n&&(i=i*n%r.value),s/=2n,n=n*n%r.value;return new t(i)}negate(){return new t(-this.value)}abs(){return new t(this.value<0n?-this.value:this.value)}compareTo(e){return this.value<e.value?-1:this.value>e.value?1:0}equals(e){return this.value===e.value}toString(e=16){if(e!==16)throw new Error(`Unsupported radix: ${e}. Only radix 16 (hexadecimal) is supported.`);return this.value.toString(16)}};var X=require("buffer/");var _=require("buffer/"),R=require("crypto-js");var O=t=>{let e=t instanceof _.Buffer?R.lib.WordArray.create(t):t,r=(0,R.SHA256)(e).toString();return new Array(64-r.length).join("0")+r},p=t=>O(_.Buffer.from(t,"hex")),u=t=>{if(!(t instanceof o))throw new Error("Not a BigInteger");let e=t.compareTo(o.ZERO)<0,r=t.abs().toString(16);if(r=r.length%2!==0?`0${r}`:r,r=/^[89a-f]/i.test(r)?`00${r}`:r,e){let s=r.split("").map(c=>{let l=~parseInt(c,16)&15;return"0123456789ABCDEF".charAt(l)}).join("");r=new o(s,16).add(o.ONE).toString(16),r.toUpperCase().startsWith("FF8")&&(r=r.substring(2))}return r},$=t=>_.Buffer.from(R.lib.WordArray.random(t).toString(),"hex"),K=t=>{if(t.length%2!==0)throw new Error("Hex encoded strings must have an even number length");let e=new Uint8Array(t.length/2);for(let r=0;r<t.length;r+=2){let n=t.slice(r,r+2).toLowerCase();if(n in k)e[r/2]=k[n];else throw new Error(`Cannot decode unrecognized sequence ${n} as hexadecimal`)}return e};var q=X.Buffer.from("Caldera Derived Key","utf8"),D=new o("2",16),m=new o("FFFFFFFFFFFFFFFFC90FDAA22168C234C4C6628B80DC1CD129024E088A67CC74020BBEA63B139B22514A08798E3404DDEF9519B3CD3A431B302B0A6DF25F14374FE1356D6D51C245E485B576625E7EC6F44C42E9A637ED6B0BFF5CB6F406B7EDEE386BFB5A899FA5AE9F24117C4B1FE649286651ECE45B3DC2007CB8A163BF0598DA48361C55D39A69163FA8FD24CF5F83655D23DCA3AD961C62F356208552BB9ED529077096966D670C354E4ABC9804F1746C08CA18217C32905E462E36CE3BE39E772C180E86039B2783A2EC07A28FB5C55DF06F4C52C9DE2BCBF6955817183995497CEA956AE515D2261898FA051015728E5A8AAAC42DAD33170D04507A33A85521ABDF1CBA64ECFB850458DBEF0A8AEA71575D060C7DB3970F85A6E1E4C7ABF5AE8CDB0933D71E8C94E04A25619DCEE3D2261AD2EE6BF12FFA06D98A0864D87602733EC86A64521F2B18177B200CBBE117577A615D6C770988C0BAD946E208E24FA074E5AB3143DB5BFCE0FD108E4B82D120A93AD2CAFFFFFFFFFFFFFFFF",16),G=new o(p(`${u(m)}${u(D)}`),16),k={"00":0,"01":1,"02":2,"03":3,"04":4,"05":5,"06":6,"07":7,"08":8,"09":9,"0a":10,"0b":11,"0c":12,"0d":13,"0e":14,"0f":15,10:16,11:17,12:18,13:19,14:20,15:21,16:22,17:23,18:24,19:25,"1a":26,"1b":27,"1c":28,"1d":29,"1e":30,"1f":31,20:32,21:33,22:34,23:35,24:36,25:37,26:38,27:39,28:40,29:41,"2a":42,"2b":43,"2c":44,"2d":45,"2e":46,"2f":47,30:48,31:49,32:50,33:51,34:52,35:53,36:54,37:55,38:56,39:57,"3a":58,"3b":59,"3c":60,"3d":61,"3e":62,"3f":63,40:64,41:65,42:66,43:67,44:68,45:69,46:70,47:71,48:72,49:73,"4a":74,"4b":75,"4c":76,"4d":77,"4e":78,"4f":79,50:80,51:81,52:82,53:83,54:84,55:85,56:86,57:87,58:88,59:89,"5a":90,"5b":91,"5c":92,"5d":93,"5e":94,"5f":95,60:96,61:97,62:98,63:99,64:100,65:101,66:102,67:103,68:104,69:105,"6a":106,"6b":107,"6c":108,"6d":109,"6e":110,"6f":111,70:112,71:113,72:114,73:115,74:116,75:117,76:118,77:119,78:120,79:121,"7a":122,"7b":123,"7c":124,"7d":125,"7e":126,"7f":127,80:128,81:129,82:130,83:131,84:132,85:133,86:134,87:135,88:136,89:137,"8a":138,"8b":139,"8c":140,"8d":141,"8e":142,"8f":143,90:144,91:145,92:146,93:147,94:148,95:149,96:150,97:151,98:152,99:153,"9a":154,"9b":155,"9c":156,"9d":157,"9e":158,"9f":159,a0:160,a1:161,a2:162,a3:163,a4:164,a5:165,a6:166,a7:167,a8:168,a9:169,aa:170,ab:171,ac:172,ad:173,ae:174,af:175,b0:176,b1:177,b2:178,b3:179,b4:180,b5:181,b6:182,b7:183,b8:184,b9:185,ba:186,bb:187,bc:188,bd:189,be:190,bf:191,c0:192,c1:193,c2:194,c3:195,c4:196,c5:197,c6:198,c7:199,c8:200,c9:201,ca:202,cb:203,cc:204,cd:205,ce:206,cf:207,d0:208,d1:209,d2:210,d3:211,d4:212,d5:213,d6:214,d7:215,d8:216,d9:217,da:218,db:219,dc:220,dd:221,de:222,df:223,e0:224,e1:225,e2:226,e3:227,e4:228,e5:229,e6:230,e7:231,e8:232,e9:233,ea:234,eb:235,ec:236,ed:237,ee:238,ef:239,f0:240,f1:241,f2:242,f3:243,f4:244,f5:245,f6:246,f7:247,f8:248,f9:249,fa:250,fb:251,fc:252,fd:253,fe:254,ff:255};var d=class extends Error{constructor(e="Could not sign SRP session"){super(e)}},B=class extends d{constructor(e="Could not sign SRP session because of missing or undefined ChallengeResponses in response"){super(e)}},A=class extends d{constructor(e="Could not sign SRP session because of missing or undefined SALT in response.ChallengeResponses"){super(e)}},C=class extends d{constructor(e="Could not sign SRP session because of missing or undefined SECRET_BLOCK in response.ChallengeResponses"){super(e)}},S=class extends d{constructor(e="Could not sign SRP session because of missing or undefined SRP_B in response.ChallengeResponses"){super(e)}},I=class extends d{constructor(e="Could not sign SRP session because of missing or undefined USER_ID_FOR_SRP in response.ChallengeResponses"){super(e)}},v=class extends d{constructor(e="Could not sign SRP session because of missing or undefined DEVICE_KEY in response.ChallengeResponses"){super(e)}},w=class extends Error{constructor(e="Aborting SRP due to 0 value"){super(e)}},P=class extends w{constructor(e="Aborting SRP due to 0 value received for client public key (A)"){super(e)}},E=class extends w{constructor(e="Aborting SRP due to 0 value received for server public key (B)"){super(e)}},H=class extends w{constructor(e="Aborting SRP due to 0 value received for public key hash (u)"){super(e)}};var le=()=>{let t=$(128).toString("hex");return new o(t,16)},ue=t=>{let e=D.modPow(t,m);if(e.equals(o.ZERO))throw new P;return e},Y=(t,e)=>{let r=g.default.lib.WordArray.create(a.Buffer.concat([q,a.Buffer.from(String.fromCharCode(1),"utf8")])),n=t instanceof a.Buffer?g.default.lib.WordArray.create(t):t,s=e instanceof a.Buffer?g.default.lib.WordArray.create(e):e,i=g.default.HmacSHA256(n,s),c=g.default.HmacSHA256(r,i);return a.Buffer.from(c.toString(),"hex").slice(0,16)},Z=(t,e)=>{let r=p(u(t)+u(e)),n=new o(r,16);if(n.equals(o.ZERO))throw new H;return n},z=(t,e,r,n)=>{let s=D.modPow(t,m);return e.subtract(G.multiply(s)).modPow(r.add(n.multiply(t)),m)},j=(t,e)=>new o(p(u(t)+e),16),de=()=>{let t=new Date,e="en-US",r="UTC",n=t.toLocaleString(e,{timeZone:r,weekday:"short"}),s=t.toLocaleString(e,{day:"numeric",timeZone:r}),i=t.toLocaleString(e,{month:"short",timeZone:r}),c=t.getUTCFullYear(),l=t.toLocaleString(e,{hour:"2-digit",hourCycle:"h23",minute:"2-digit",second:"2-digit",timeZone:r});return`${n} ${i} ${s} ${l} UTC ${c}`},fe=(t,e,r)=>g.default.HmacSHA256(`${t}${e}`,r).toString(g.default.enc.Base64),J=(t,e,r)=>{let s=`${r.split("_")[1]}${t}:${e}`;return O(s)},Q=(t,e,r)=>{let n=`${r}${t}:${e}`;return O(n)},he=(t,e)=>{let r=$(40).toString("base64"),n=Q(t,r,e),s=$(16).toString("hex"),i=u(new o(s,16)),c=K(i),l=a.Buffer.from(c).toString("base64"),f=p(i+n),b=D.modPow(new o(f,16),m),x=u(b),F=K(x),h=a.Buffer.from(F).toString("base64");return{DeviceRandomPassword:r,DeviceSecretVerifierConfig:{PasswordVerifier:h,Salt:l}}},pe=(t,e,r,n=!0)=>{let s=r.split("_")[1],i=de(),c=le(),l=ue(c);return{username:t,poolId:r,poolIdAbbr:s,password:e,isHashed:n,timestamp:i,smallA:c.toString(16),largeA:l.toString(16)}},me=(t,e)=>{if(!e.ChallengeParameters)throw new B;if(!e.ChallengeParameters.SALT)throw new A;if(!e.ChallengeParameters.SECRET_BLOCK)throw new C;if(!e.ChallengeParameters.SRP_B)throw new S;if(!e.ChallengeParameters.USER_ID_FOR_SRP)throw new I;let{SALT:r,SECRET_BLOCK:n,SRP_B:s,USER_ID_FOR_SRP:i}=e.ChallengeParameters,{poolId:c,poolIdAbbr:l,password:f,isHashed:b,timestamp:x,smallA:F,largeA:h}=t;if(s.replace(/^0+/,"")==="")throw new E;let L=b?f:J(i,f,c),y=Z(new o(h,16),new o(s,16)),W=j(new o(r,16),L),V=z(W,new o(s,16),new o(F,16),y),U=Y(a.Buffer.from(u(V),"hex"),a.Buffer.from(u(y),"hex")),N=g.default.lib.WordArray.create(U),ee=g.default.lib.WordArray.create(a.Buffer.concat([a.Buffer.from(l,"utf8"),a.Buffer.from(i,"utf8"),a.Buffer.from(n,"base64"),a.Buffer.from(x,"utf8")])),te=g.default.enc.Base64.stringify(g.default.HmacSHA256(ee,N));return{...t,salt:r,secret:n,largeB:s,passwordSignature:te}},Be=(t,e,r,n)=>{if(!e.ChallengeParameters)throw new B;if(!e.ChallengeParameters.SALT)throw new A;if(!e.ChallengeParameters.SECRET_BLOCK)throw new C;if(!e.ChallengeParameters.SRP_B)throw new S;if(!e.ChallengeParameters.DEVICE_KEY)throw new v;let{DEVICE_KEY:s,SALT:i,SECRET_BLOCK:c,SRP_B:l}=e.ChallengeParameters,{timestamp:f,smallA:b,largeA:x}=t;if(l.replace(/^0+/,"")==="")throw new E;let F=Q(s,n,r),h=Z(new o(x,16),new o(l,16)),L=j(new o(i,16),F),y=z(L,new o(l,16),new o(b,16),h),W=Y(a.Buffer.from(u(y),"hex"),a.Buffer.from(u(h),"hex")),V=g.default.lib.WordArray.create(W),U=g.default.lib.WordArray.create(a.Buffer.concat([a.Buffer.from(r,"utf8"),a.Buffer.from(s,"utf8"),a.Buffer.from(c,"base64"),a.Buffer.from(f,"utf8")])),N=g.default.enc.Base64.stringify(g.default.HmacSHA256(U,V));return{...t,salt:i,secret:c,largeB:l,passwordSignature:N}},Ae=(t,e)=>({...e,AuthParameters:{...e.AuthParameters,SRP_A:t.largeA}}),Ce=(t,e)=>({...e,ChallengeResponses:{...e.ChallengeResponses,PASSWORD_CLAIM_SECRET_BLOCK:t.secret,PASSWORD_CLAIM_SIGNATURE:t.passwordSignature,SRP_A:t.largeA,TIMESTAMP:t.timestamp}});
/*!
 * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
 * SPDX-License-Identifier: Apache-2.0
 */
